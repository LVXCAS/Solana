---
phase: 01-security-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/index.ts
  - src/commands/create.ts
  - src/utils/prompts.ts
  - src/utils/display.ts
autonomous: true

must_haves:
  truths:
    - "User can run CLI and enter token parameters via prompts"
    - "CLI shows cost estimation before proceeding"
    - "CLI displays progress spinners during transactions"
    - "CLI shows Solana Explorer links after success"
    - "CLI shows clear error messages with remediation steps"
    - "User can pass all parameters via flags to skip prompts"
  artifacts:
    - path: "src/index.ts"
      provides: "CLI entry point with create command"
      exports: ["program"]
    - path: "src/commands/create.ts"
      provides: "Token creation command handler"
      exports: ["createCommand"]
    - path: "src/utils/prompts.ts"
      provides: "Inquirer prompt definitions"
      exports: ["promptTokenConfig"]
    - path: "src/utils/display.ts"
      provides: "Output formatting with chalk/ora"
      exports: ["displaySuccess", "displayError", "displayCostEstimate", "displayTokenResult", "createSpinner"]
  key_links:
    - from: "src/index.ts"
      to: "src/commands/create.ts"
      via: "imports createCommand"
      pattern: "import.*createCommand.*from.*commands/create"
    - from: "src/commands/create.ts"
      to: "src/lib/token.ts"
      via: "imports createToken, estimateCost, verifyAuthorities"
      pattern: "import.*from.*lib/token"
    - from: "src/commands/create.ts"
      to: "src/utils/prompts.ts"
      via: "imports promptTokenConfig"
      pattern: "import.*promptTokenConfig"
    - from: "src/commands/create.ts"
      to: "src/utils/display.ts"
      via: "imports display functions"
      pattern: "import.*from.*utils/display"
---

<objective>
Build the complete CLI interface with interactive prompts, cost estimation, progress indicators, and comprehensive output formatting.

Purpose: This completes Phase 1 by wrapping the token creation logic in a user-friendly CLI that fulfills all CLI requirements (CLI-01 through CLI-04). After this, users can create anti-rug tokens through a polished command-line experience.

Output: Fully functional CLI tool that creates SPL tokens with security controls via `memecoin-factory create`.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-security-foundation/01-RESEARCH.md
@.planning/phases/01-security-foundation/01-01-SUMMARY.md
@.planning/phases/01-security-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create prompts and enhanced display utilities</name>
  <files>src/utils/prompts.ts, src/utils/display.ts</files>
  <action>
    1. Create src/utils/prompts.ts with Inquirer prompts:

       Export async function promptTokenConfig(existingConfig?: Partial&lt;TokenConfig&gt;): Promise&lt;TokenConfig&gt;

       Prompts (skip if value already provided in existingConfig):
       - name: input, "Token name (1-32 characters):", validate 1-32 chars
       - symbol: input, "Token symbol (1-10 characters):", validate 1-10 chars, transform to uppercase
       - decimals: number, "Decimals (0-9):", default 9, validate 0-9 integer
       - supply: input, "Initial supply:", validate positive number, parse to number

       Use @inquirer/prompts (modern ESM API):
       - import { input, number } from '@inquirer/prompts';

    2. Enhance src/utils/display.ts with full formatting:

       a. createSpinner(text: string): Ora
          - Return ora(text) spinner instance

       b. displayCostEstimate(costs: {rent: number, fees: number, total: number}): void
          - Format as table:
            ```
            Cost Estimate:
              Rent exemption:  0.001461600 SOL
              Transaction fees: 0.000020000 SOL
              Total:           0.001481600 SOL
            ```
          - Use chalk for styling (cyan for labels, white for values)

       c. displayTokenResult(result: TokenResult, cluster: string): void
          - Format as success message with all details:
            ```
            Token Created Successfully!

            Mint Address: ABC123...
            Token Account: DEF456...
            Supply: 1,000,000 TEST

            Transactions:
              - Mint created: https://explorer.solana.com/tx/...?cluster=devnet
              - Authorities revoked: https://explorer.solana.com/tx/...?cluster=devnet

            Authority Status:
              Mint Authority: REVOKED (supply fixed)
              Freeze Authority: REVOKED (no honeypot risk)

            View token: https://explorer.solana.com/address/{mint}?cluster=devnet
            ```
          - Use chalk.green for success, chalk.gray for labels

       d. displayError(error: Error | string, context?: string): void
          - Format error with remediation hints:
            ```
            Error: Insufficient SOL balance

            Required: 0.00148 SOL
            Available: 0.00100 SOL
            Shortfall: 0.00048 SOL

            To fix:
              solana airdrop 1 --url devnet
            ```
          - Detect common errors and provide specific remediation:
            - "insufficient" -> Show balance, suggest airdrop
            - "keypair" or "file not found" -> Show keypair path help
            - "timeout" or "blockhash" -> Suggest retry, note devnet instability
            - Default: Show raw error with generic troubleshooting

       e. promptConfirmation(message: string): Promise&lt;boolean&gt;
          - Use @inquirer/prompts confirm()
          - "Proceed with token creation? (cost: X SOL)"

    Imports:
    - import { input, number, confirm } from '@inquirer/prompts';
    - import ora from 'ora';
    - import chalk from 'chalk';
  </action>
  <verify>
    Test prompts in isolation:
    ```bash
    npx ts-node -e "
    import { promptTokenConfig } from './src/utils/prompts.js';
    promptTokenConfig({name: 'PresetName'}).then(console.log);
    "
    ```
    Should prompt for symbol, decimals, supply (skip name since preset).

    Test display functions:
    ```bash
    npx ts-node -e "
    import { displayCostEstimate, displayError } from './src/utils/display.js';
    displayCostEstimate({rent: 1461600, fees: 20000, total: 1481600});
    displayError(new Error('insufficient funds for rent'));
    "
    ```
    Should show formatted output with colors.
  </verify>
  <done>
    - promptTokenConfig() collects all token parameters with validation
    - Prompts skip parameters already provided (for hybrid flag/prompt approach)
    - displayCostEstimate() shows formatted cost breakdown
    - displayTokenResult() shows complete success output with Explorer links
    - displayError() provides remediation steps for common errors
    - All functions use chalk/ora for styled terminal output
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement create command and wire CLI</name>
  <files>src/commands/create.ts, src/index.ts</files>
  <action>
    1. Create src/commands/create.ts:

       Export function createCommand(program: Command): void

       Add "create" command with options:
       - -n, --name &lt;name&gt;: Token name
       - -s, --symbol &lt;symbol&gt;: Token symbol
       - -d, --decimals &lt;decimals&gt;: Decimals (0-9)
       - -a, --supply &lt;amount&gt;: Initial supply
       - -k, --keypair &lt;path&gt;: Keypair file path (default: ~/.config/solana/id.json)
       - -c, --cluster &lt;cluster&gt;: Cluster (devnet/mainnet-beta, default: devnet)
       - -y, --yes: Skip confirmation prompt

       Command handler async function:
       a. Load keypair using loadKeypair()
       b. Create connection to cluster
       c. Check balance using checkSufficientBalance()
       d. Get cost estimate using estimateCost()
       e. Prompt for missing parameters using promptTokenConfig()
       f. Display cost estimate
       g. Unless --yes, prompt for confirmation
       h. Create spinner: "Creating token..."
       i. Call createToken() - update spinner at each step:
          - "Creating mint account..."
          - "Minting initial supply..."
          - "Revoking mint authority..."
          - "Revoking freeze authority..."
       j. Verify authorities using verifyAuthorities()
       k. Display success with displayTokenResult()

       Error handling:
       - Wrap entire flow in try/catch
       - On error: spinner.fail(), displayError(), process.exit(1)

    2. Update src/index.ts:

       Import createCommand from ./commands/create.js
       Create program with:
       - name: "memecoin-factory"
       - description: "Create SPL tokens with anti-rug security controls"
       - version: from package.json (import { readFileSync } from 'fs', parse package.json)

       Call createCommand(program) to register the command
       Call program.parse()

    Flow example:
    ```
    $ memecoin-factory create

    Token name (1-32 characters): MyToken
    Token symbol (1-10 characters): MTK
    Decimals (0-9): 9
    Initial supply: 1000000

    Cost Estimate:
      Rent exemption:  0.001461600 SOL
      Transaction fees: 0.000020000 SOL
      Total:           0.001481600 SOL

    Proceed with token creation? (y/N) y

    Creating mint account...
    Minting initial supply...
    Revoking mint authority...
    Revoking freeze authority...

    Token Created Successfully!
    ...
    ```
  </action>
  <verify>
    1. Test help:
       ```bash
       npm run dev -- create --help
       ```
       Should show all options with descriptions.

    2. Test with flags (skip prompts):
       ```bash
       npm run dev -- create --name "TestToken" --symbol "TEST" --decimals 9 --supply 1000000 --yes
       ```
       Should create token without prompts (requires devnet SOL).

    3. Test interactive mode:
       ```bash
       npm run dev -- create
       ```
       Should prompt for all parameters.

    4. Test error handling (no keypair):
       ```bash
       npm run dev -- create --keypair /nonexistent/path
       ```
       Should show error with remediation.

    5. Test insufficient balance:
       - Use a new keypair with no SOL
       - Should show balance error with airdrop suggestion
  </verify>
  <done>
    - CLI create command accepts all options via flags
    - Missing options trigger interactive prompts
    - Cost estimation displayed before confirmation
    - Progress spinners show transaction progress
    - Success output includes all details and Explorer links
    - Error messages include remediation steps
    - --yes flag skips confirmation for scripting
  </done>
</task>

<task type="auto">
  <name>Task 3: End-to-end verification on devnet</name>
  <files>None (verification only)</files>
  <action>
    Perform complete end-to-end test of token creation flow:

    1. Ensure devnet SOL available:
       ```bash
       solana balance --url devnet
       # If low: solana airdrop 2 --url devnet
       ```

    2. Run full interactive flow:
       ```bash
       npm run dev -- create
       ```
       Enter: name="E2ETest", symbol="E2E", decimals=6, supply=500000
       Confirm when prompted.

    3. Verify on Solana Explorer:
       - Click the token link in output
       - Confirm "Mint Authority: Disabled"
       - Confirm "Freeze Authority: Disabled"
       - Confirm supply matches (500000 * 10^6 = 500000000000)

    4. Run automated flow:
       ```bash
       npm run dev -- create -n "AutoTest" -s "AUTO" -d 9 -a 1000000 -y
       ```
       Should complete without prompts.

    5. Test error recovery:
       - Create token with invalid name (empty or 50+ chars)
       - Should show validation error immediately
       - Try with insufficient balance
       - Should show balance error with airdrop command

    Document any issues found for troubleshooting.
  </action>
  <verify>
    Verification checklist:
    - [ ] Interactive mode works end-to-end
    - [ ] Flag mode works end-to-end
    - [ ] Solana Explorer shows correct token metadata
    - [ ] Mint authority shows as disabled
    - [ ] Freeze authority shows as disabled
    - [ ] Supply matches input
    - [ ] Explorer links in output are clickable and correct
    - [ ] Error messages are helpful
  </verify>
  <done>
    - Complete token creation verified on Solana devnet
    - Token visible in Solana Explorer with correct attributes
    - Both authorities confirmed revoked on-chain
    - CLI provides professional UX with spinners, colors, Explorer links
    - Error handling tested and working
  </done>
</task>

</tasks>

<verification>
Phase 1 complete verification:

1. Requirements checklist:
   - [ ] TOKEN-01: Create SPL tokens with name/symbol/decimals/supply - VERIFIED via create command
   - [ ] SEC-01: Mint authority revoked - VERIFIED on Solana Explorer
   - [ ] SEC-02: Freeze authority revoked - VERIFIED on Solana Explorer
   - [ ] CLI-01: Interactive prompts with validation - VERIFIED via create command
   - [ ] CLI-02: Cost estimation shown - VERIFIED in CLI output
   - [ ] CLI-03: Explorer links provided - VERIFIED in success output
   - [ ] CLI-04: Error messages with remediation - VERIFIED via error testing

2. Functional test:
   ```bash
   # Full flow
   npm run dev -- create -n "FinalTest" -s "FINAL" -d 9 -a 1000000 -y

   # Verify output includes:
   # - Mint address
   # - Transaction links
   # - "Mint Authority: REVOKED"
   # - "Freeze Authority: REVOKED"
   ```

3. Build verification:
   ```bash
   npm run build
   node dist/index.js create --help
   ```
   Compiled version should work identically.
</verification>

<success_criteria>
Phase 1 Plan 03 is complete when:
- CLI create command works with both flags and interactive prompts
- Cost estimation displays before confirmation
- Progress spinners indicate transaction progress
- Success output shows mint address, supply, transaction links, authority status
- Solana Explorer links are correct and clickable
- Error messages provide specific remediation steps
- Token created on devnet has both authorities revoked (verified on-chain)
- All 7 Phase 1 requirements (TOKEN-01, SEC-01, SEC-02, CLI-01-04) verified complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-security-foundation/01-03-SUMMARY.md`
</output>
