---
phase: 02-professional-metadata
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - src/commands/create.ts
  - src/utils/prompts.ts
  - src/utils/display.ts
  - src/utils/educational.ts
autonomous: true

must_haves:
  truths:
    - "User prompted for description and image path when creating token"
    - "CLI shows step-by-step explanations during operations"
    - "User can run --dry-run to preview without spending SOL"
    - "Authority dashboard shown after token creation"
    - "User prompted to optionally revoke metadata authority"
  artifacts:
    - path: "src/utils/educational.ts"
      provides: "Educational output helpers"
      exports: ["educationalSpinner", "explain"]
    - path: "src/commands/create.ts"
      provides: "Extended create command with metadata flow"
      min_lines: 200
  key_links:
    - from: "src/commands/create.ts"
      to: "src/services/ipfs.ts"
      via: "uploadImage call"
      pattern: "uploadImage.*imagePath"
    - from: "src/commands/create.ts"
      to: "src/services/metadata.ts"
      via: "createTokenMetadata call"
      pattern: "createTokenMetadata"
    - from: "src/commands/create.ts"
      to: "src/services/authority.ts"
      via: "getAuthorityStatus and revokeMetadataAuthority calls"
      pattern: "(getAuthorityStatus|revokeMetadataAuthority)"
---

<objective>
Wire all Phase 2 services into the create command with educational output and dry-run mode.

Purpose: This plan brings everything together - the create command now handles metadata (IPFS upload + Metaplex creation), shows step-by-step explanations for learning, displays authority dashboard, and supports dry-run preview.

Output: Complete token creation flow with professional metadata, educational UX, and safety features.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan outputs
@.planning/phases/02-professional-metadata/02-01-SUMMARY.md
@.planning/phases/02-professional-metadata/02-02-SUMMARY.md
@.planning/phases/02-professional-metadata/02-03-SUMMARY.md

# Research
@.planning/phases/02-professional-metadata/02-RESEARCH.md

# Existing code
@src/commands/create.ts
@src/utils/prompts.ts
@src/utils/display.ts
@src/services/ipfs.ts
@src/services/metadata.ts
@src/services/authority.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create educational output utilities</name>
  <files>src/utils/educational.ts</files>
  <action>
Create `src/utils/educational.ts` with:

1. **explain function:**
```typescript
export function explain(message: string): void
```
Outputs educational context in dim gray, indented with arrow:
```
  -> IPFS provides permanent, decentralized storage via content addressing
```

2. **educationalSpinner function:**
```typescript
export async function educationalSpinner<T>(
  label: string,
  explanation: string,
  operation: () => Promise<T>
): Promise<T>
```
- Create ora spinner with label
- Output explanation using explain()
- Run operation
- On success: spinner.succeed()
- On error: spinner.fail(), rethrow
- Return result

Example usage:
```typescript
const result = await educationalSpinner(
  'Uploading logo to IPFS...',
  'IPFS is a peer-to-peer network for storing files. Your logo gets a unique content hash (CID) that anyone can use to retrieve it.',
  () => uploadImage(imagePath)
);
```

3. **Operation explanations** - export object with explanations for each step:
```typescript
export const EXPLANATIONS = {
  ipfsUpload: 'IPFS stores your image permanently using content addressing...',
  metadataJson: 'Metadata JSON contains name/symbol/description pointing to your image...',
  metadataAccount: 'Metaplex creates an on-chain account linking your token to metadata...',
  mintAuthority: 'Revoking mint authority prevents anyone from creating more tokens...',
  freezeAuthority: 'Revoking freeze authority prevents honeypot attacks...',
  metadataAuthority: 'Revoking metadata authority locks name/symbol permanently...',
};
```

Keep explanations concise (1-2 sentences). This is a learning tool, not documentation.
  </action>
  <verify>
`npm run build` succeeds
`src/utils/educational.ts` exports educationalSpinner, explain, EXPLANATIONS
  </verify>
  <done>Educational output utilities ready for use in create command</done>
</task>

<task type="auto">
  <name>Task 2: Add metadata prompts</name>
  <files>src/utils/prompts.ts</files>
  <action>
Extend `src/utils/prompts.ts` with new prompts:

1. **promptDescription function:**
```typescript
export async function promptDescription(): Promise<string>
```
- Use input prompt with message: "Token description (for explorers/wallets):"
- Optional - allow empty (press enter to skip)
- If empty, default to: "Created with Memecoin Factory"

2. **promptImagePath function:**
```typescript
export async function promptImagePath(): Promise<string | undefined>
```
- Use input prompt with message: "Token logo path (png/jpg, optional):"
- Allow empty (press enter to skip)
- If provided, validate using validateImagePath from validation.ts
- If validation fails, show error and re-prompt
- Return undefined if skipped

3. **promptLockMetadata function:**
```typescript
export async function promptLockMetadata(): Promise<boolean>
```
- Use confirm prompt
- Message: "Lock metadata permanently? (name/symbol cannot be changed)"
- Default: false (safer default)
- Add note in yellow: "This is IRREVERSIBLE"

4. **Update promptTokenConfig:**
If partialConfig doesn't have description/imagePath, call the new prompts.
Keep existing behavior for name/symbol/decimals/supply.
  </action>
  <verify>
`npm run build` succeeds
prompts.ts exports promptDescription, promptImagePath, promptLockMetadata
  </verify>
  <done>Metadata prompts added with validation and safe defaults</done>
</task>

<task type="auto">
  <name>Task 3: Extend create command with full metadata flow</name>
  <files>src/commands/create.ts, src/utils/display.ts</files>
  <action>
**Update create command options:**
Add new flags:
```typescript
.option('--description <text>', 'Token description')
.option('--image <path>', 'Token logo file path')
.option('--lock-metadata', 'Revoke metadata update authority', false)
.option('--dry-run', 'Preview operations without executing', false)
```

**Update create command flow:**

1. **Early validation (before any prompts):**
- If --image provided, validate path exists and is valid image

2. **Dry-run mode check:**
If --dry-run flag set:
```typescript
console.log(chalk.yellow('\nDRY RUN MODE - No transactions will be executed\n'));

// Show what would happen
console.log(chalk.cyan('Operations that would be performed:\n'));
console.log('  1. Load keypair from:', options.keypair);
console.log('  2. Upload logo to IPFS:', imagePath || '(none)');
console.log('  3. Create metadata JSON with:');
console.log('     - Name:', config.name);
console.log('     - Symbol:', config.symbol);
console.log('     - Description:', config.description);
console.log('  4. Upload metadata JSON to IPFS');
console.log('  5. Create SPL token mint');
console.log('  6. Mint initial supply:', config.supply);
console.log('  7. Create Metaplex metadata account');
console.log('  8. Revoke mint authority');
console.log('  9. Revoke freeze authority');
if (options.lockMetadata) {
  console.log('  10. Revoke metadata update authority');
}

// Show cost estimate
displayCostEstimate(costs);

console.log(chalk.dim('\nRemove --dry-run to execute these operations'));
return;
```

3. **Normal execution flow with educational spinners:**

a. After token creation (existing code), add metadata creation:
```typescript
if (config.imagePath) {
  await educationalSpinner(
    'Uploading token logo to IPFS...',
    EXPLANATIONS.ipfsUpload,
    () => uploadImage(config.imagePath!)
  );

  await educationalSpinner(
    'Creating metadata JSON...',
    EXPLANATIONS.metadataJson,
    () => uploadMetadata({...})
  );

  await educationalSpinner(
    'Creating on-chain metadata account...',
    EXPLANATIONS.metadataAccount,
    () => createTokenMetadata(connection, keypair, result.mint, metadataConfig)
  );
}
```

b. After all creation, display authority dashboard:
```typescript
const authorityStatus = await getAuthorityStatus(connection, result.mint, keypair.publicKey);
displayAuthorityDashboard(authorityStatus);
```

c. If --lock-metadata flag OR user prompted and confirmed:
```typescript
if (shouldLockMetadata) {
  await educationalSpinner(
    'Revoking metadata update authority...',
    EXPLANATIONS.metadataAuthority,
    () => revokeMetadataAuthority(connection, keypair, result.mint)
  );
}
```

4. **Update success output:**
- Include metadata IPFS links if metadata was created
- Include metadata account address
- Keep existing explorer links

**Add displayMetadataResult to display.ts:**
```typescript
export function displayMetadataResult(
  imageUri: string,
  metadataUri: string,
  metadataAccount: string,
  cluster: string
): void
```
Show IPFS URIs and metadata account explorer link.

**Handle errors:**
- IPFS errors: show remediation about PINATA_JWT
- Metaplex errors: show remediation based on error type
- Preserve existing error handling patterns
  </action>
  <verify>
`npm run build` succeeds
`npm run dev -- create --help` shows new flags (--description, --image, --lock-metadata, --dry-run)
  </verify>
  <done>Create command fully integrated with metadata, educational output, and dry-run mode</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` - compiles without errors
2. `npm run dev -- create --help` shows all new flags
3. `npm run dev -- create --dry-run` shows preview without executing
4. Educational output appears during operations
5. Authority dashboard displays after token creation
</verification>

<success_criteria>
- Create command accepts --description, --image, --lock-metadata, --dry-run flags
- Dry-run mode shows complete operation preview without blockchain/IPFS calls
- Educational spinners explain each step during execution
- Authority dashboard shows all three authority types
- Optional metadata authority revocation with irreversibility warning
- Error messages include specific remediation hints
- IPFS and metadata links shown in success output
- Phase 1 behavior preserved when metadata options not provided
</success_criteria>

<output>
After completion, create `.planning/phases/02-professional-metadata/02-04-SUMMARY.md`
</output>
